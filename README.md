# Keywords for Black Louisiana

The public Jekyll site for the documents in the K4BL project. See our [project overview](https://github.com/lxcprojects/k4bl) for general information about the project!

## Prerequisites

- Ruby 2.7.x
- [imagemagick](https://imagemagick.org/) - used to (locally) generate image derivatives

Please refer to the [Wax installation instructions](https://minicomp.github.io/wiki/wax/setting-up-your-system/install-manually/) to setup your development environment.

## Technology Used

  - [Wax Facets](https://github.com/minicomp/wax-facets) - a Jekyll theme based on the [Wax](https://minicomp.github.io/wax/) theme. This includes the following
    - [Bootstrap 4](https://getbootstrap.com/docs/4.0/getting-started/introduction/) for styling

## Local Development

Our site is built automatically in GitHub whenever a change is made to the `main` branch and deployed using GitHub Pages. Because of the way Wax generates pages and images, we need to keep the Wax generated files out of GitHub so they can be regenerated by GitHub in order to ensure the most up to date content appears on the site. This means that developers will need to also generate these files locally during development and manually keep them up to date as needed.

All commands below are run on the command line (bash or zsh work).

### Wax tasks

Generate pages for our data:
``` sh
bundle exec rake wax:pages keywords
bundle exec rake wax:pages keywords_descriptions
bundle exec rake wax:pages people
```

Generate search index:
``` sh
bundle exec rake wax:search main
```

Generate image derivatives:
``` sh
bundle exec rake wax:derivatives:iiif keywords
```

Running the script to generate image derivatives requires that you have [imagemagick](https://imagemagick.org/) installed on your computer.

Also note that the IIIF image derivative script here will modify `_data/keywords.csv` by appending image related URLs as new columns, or modifying those columns as needed. Those changes _should_ be captured in `git`, but don't strictly need to be captured.

### Jekyll

After you have the Wax tasks run and all of the Wax files generated successfully, we can use Jekyll to run the site locally so you can see the changes as you develop the site.

``` sh
bundle exec jekyll serve
```

You should get output similar to the following to know that Jekyll is working. You'll then be able to navigate to http://localhost:4000/ to view your local develompent site.

> ``` sh
> Configuration file: /home/john/workspace/keywords/keywords/_config.yml
>            Source: /home/john/workspace/keywords/keywords
>       Destination: /home/john/workspace/keywords/keywords/_site
> Incremental build: disabled. Enable with --incremental
>      Generating... 
>           Warning: Empty `slug` generated for ''.
>                    done in 1.808 seconds.
> Auto-regeneration: enabled for '/home/john/workspace/keywords/keywords'
>    Server address: http://127.0.0.1:4000
>  Server running... press ctrl-c to stop.
> ```

## Example Developement Workflow

First time setup:

``` bash
# Install all Ruby dependencies
bundle install
```

Development:

``` bash
# If any of the raw images in `_data/raw_images/` are modified
# Clear out old IIIF images
rm -rf img/

# Generate images for website
bundle exec rake wax:derivatives:iiif keywords

# --------
# If the CSV was updated, remove the old pages
rm _keywords/*.md  _keywords_descriptions/*.md _people/*.md

# Generate website pages
bundle exec rake wax:pages keywords
bundle exec rake wax:pages keywords_descriptions
bundle exec rake wax:pages people

# --------
# Update search index
bundle exec rake wax:search main
```

---

### Installing Ruby on Ubuntu

You may not have the correct dependencies to install the required version of Ruby if you are using Ubuntu. Installing the following should fix this.

``` bash
sudo apt install build-essential zlib1g-dev
```

## Team page setup

The "Our Team" page at `/team/` collects all of the markdown documents in the `_team/` folder in a list view. Each of these individual team member pages need some metadata to be displayed correctly.

- **name** - the team member's name
- **jobtitle** - their role or title on the project?
- **image** - the relative file path of the team member's portrait. If left blank or left out, then a placeholder image is used
- **alum** - (Optional) [true|false] Set this to `true` if this team member has moved on from the project. If no value is provided, this is assumed to be `false`
- **founder** - (Optional) [true|false] Set this to `true` if this team member was a founding member of the project. If no value is provided, this is assumed to be `false`
- **order** - (Optional) [Integer] If you need to define an explicit order to the team members list, this property can be defined to set the sorting order. This needs to be an integer in counting order, e.g. between two team members with `order: 1` and `order: 2`, the `order: 1` will appear before `order: 2` on the web site. If any ordering is needed, it is recommended that an explicit order value is then provided for *all* team members.

### Example team member entry

`/_team/my_example_entry.md`
```
---
name: My Name
jobtitle: Did the cool stuff
image: /assets/figures/headshots/my_picture.jpg
alum: true
---

This is my bio. Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.

Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus ex sapien vitae pellentesque sem placerat. In id cursus mi pretium tellus duis convallis. Tempus leo eu aenean sed diam urna tempor. Pulvinar vivamus fringilla lacus nec metus bibendum egestas. Iaculis massa nisl malesuada lacinia integer nunc posuere. Ut hendrerit semper vel class aptent taciti sociosqu. Ad litora torquent per conubia nostra inceptos himenaeos.
```

This example will add the following to the list of Keywords Alumni: ![Sample team member entry](/assets/figures/example-team-entry.png)
