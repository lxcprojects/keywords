---
layout: default
---

{% assign links = site[page.collection] | sort: 'order' | map: 'url' %}
{% for link in links %}
  {% if link == page.url %}
    {% if forloop.first %}
      {% assign prevlink = links | last %}
      {% assign nextlink = links[forloop.index] %}
    {% elsif forloop.last %}
      {% assign prevlink = prev %}
      {% assign nextlink = links | first %}
    {% else %}
      {% assign prevlink = prev %}
      {% assign nextlink = links[forloop.index] %}
    {% endif %}
  {% endif %}
  {% assign prev = link %}
{% endfor %}

<div class="row">
  <div class="pagination mx-auto">
    <div class='pagination-link' id='prevlink'><a href='{{ prevlink | absolute_url }}' >&#9668;</a></div>
    <div class='pagination-link' id='nextlink'><a href='{{ nextlink | absolute_url }}' >&#9658;</a></div>  </div>
</div>


<div class='row card thumbnail-card'>


<!-- The block below controls the image viewer -->

  {% if page.image_viewer %}
    {% assign viewer = page.image_viewer %}
  {% elsif layout.image_viewer %}
    {% assign viewer = layout.image_viewer %}
  {% endif %}

  {% if viewer %}
    <div class='item-view w-100 mb-2' >
      {% if viewer == 'openseadragon' %}
        {% include osd_iiif_image_viewer.html manifest=page.manifest prevlink=prevlink nextlink=nextlink %}
      {% else %}
        {% include simple_image_viewer.html full_image=page.full prevlink=prevlink nextlink=nextlink %}
      {% endif %}
    </div>
  {% endif %}

  <div class="card-body item-metadata w-100">

<!-- The block below controls the item metadata table -->

    <h1 alt="{{ page.label }}" class='item-label'>{{ page.label }}</h1>

    <section>
      {{content}}
    </section>

    <div class="row">
      {% if layout.meta.size %}
        {% assign metadata = layout.meta %}
      {% elsif page.meta.size %}
        {% assign metadata = page.meta %}
      {% endif %}
      {% if metadata.size %}
        {% include keywords_metadata.html meta=metadata %}
      {% endif %}
    </div>

    <div>
      {% assign excerpt = site.documents | where: 'collection', page.collection | where_exp: 'doc', "doc.path contains '/excerpts/'" | where: 'basename', page.pid | first %}
      {% if excerpt %}
        {% capture excerpt_file %}excerpts/{{ page.pid }}.md{% endcapture %}
        {% capture data %}{% include_relative {{ excerpt_file }} %}{% endcapture %}
        <div class="excerpt">
          {{ data | markdownify }}  
        </div>
      {% endif %}
    </div>
  </div>
</div>

<script type="module">
  import * as Motion from "{{ '/assets/js/motion.12.9.7.min.js' | absolute_url }}";

  const hiddenElements = [
    '.card',
    '.metadata-block dt',
    '.metadata-block dd',
    '.metadata-block dd .badge-pill',
    '.excerpt h1',
    '.excerpt h2',
    '.excerpt p',
    '.excerpt div'
  ].join(',');

  // Initial page load
  // TODO:
  // Not quite right, we'll want the pills to stagger-appear inline with
  // its container <dd>. Currently, all <dt> and <dd> stagger-appear, then
  // the pills stagger-appear
  Motion.animate(hiddenElements, { opacity: 0 }, { duration: 0 })
    .then(() => Motion.animate('.card', { opacity: 1 }, { duration: 0.2 }))
    .then(() => Motion.animate(
        '.metadata-block dt, .metadata-block dd',
        { opacity: 1 },
        { delay: Motion.stagger(0.05) }
      ).then(() => {
        return Promise.all([
          Motion.animate(
            '.metadata-block dd .badge-pill',
            { opacity: 1 },
            { delay: Motion.stagger(0.1) }
          ),
          Motion.animate(
            '.excerpt h1, .excerpt h2, .excerpt p, .excerpt div',
            { opacity: 1 },
            { duration: 0.5 }
          )
        ]);
      })
    );
</script>